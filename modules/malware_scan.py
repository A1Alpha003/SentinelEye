import requests
from modules.hashing import calculate_hash

API_KEY = '4ad9ec2f8c4fd1149de71fbc792e66cde115b638afbdbb6fb7f8c77b0ef29507'

def scan_with_virustotal(file_path):
    file_hash = calculate_hash(file_path)
    url = f"https://www.virustotal.com/api/v3/files/{file_hash}"

    headers = {
        "x-apikey": API_KEY
    }

    response = requests.get(url, headers=headers)

    if response.status_code == 200:
        data = response.json()
        result = data["data"]["attributes"]["last_analysis_stats"]
        return {
            "hash": file_hash,
            "malicious": result["malicious"],
            "suspicious": result["suspicious"],
            "undetected": result["undetected"]
        }
    else:
        return {"error": "File not found in VirusTotal database"}
